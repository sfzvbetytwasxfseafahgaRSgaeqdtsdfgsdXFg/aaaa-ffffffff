if not getgenv().Data or not getgenv().Data.authenticated then
    game:GetService("Players").LocalPlayer:Kick("Run the loader first")
    return
end

-- ===== COMPATIBILITY LAYER FOR MISSING FUNCTIONS =====
-- Add this at the very top before any other code

-- fireclickdetector compatibility
if not fireclickdetector then
    getgenv().fireclickdetector = function(clickDetector, distance)
        distance = distance or 0
        local VirtualInputManager = game:GetService("VirtualInputManager")
        local camera = workspace.CurrentCamera
        
        -- Get the part that has the ClickDetector
        local part = clickDetector.Parent
        if not part or not part:IsA("BasePart") then
            return
        end
        
        -- Store original CFrame
        local originalCFrame = camera.CFrame
        
        -- Point camera at the part
        camera.CFrame = CFrame.new(camera.CFrame.Position, part.Position)
        
        -- Fire the click
        pcall(function()
            clickDetector:Fire()
        end)
        
        -- Also try direct invocation
        pcall(function()
            for _, connection in pairs(getconnections(clickDetector.MouseClick)) do
                connection:Fire()
            end
        end)
        
        -- Restore camera
        camera.CFrame = originalCFrame
    end
end

-- hookmetamethod compatibility
if not hookmetamethod then
    getgenv().hookmetamethod = function(game, method, hook)
        -- Return a dummy function that returns the hook
        return function(t, k)
            return hook(t, k)
        end
    end
end

-- ===== END COMPATIBILITY LAYER =====

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local UserInputService = game:GetService("UserInputService")
local Workspace = workspace
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local MaterialService = game:GetService("MaterialService")
local Player = Players.LocalPlayer

-- FPS Tracking
local fpsVar = 60
RunService.Heartbeat:Connect(function(dt)
    fpsVar = math.floor(1 / dt)
end)

-- Set FPS cap if available
if setfpscap then
    setfpscap(getgenv().AutofarmSettings.Main.Fps)
end

-- Visual optimization classes
local visualClasses = {
    "Decal", "Texture", "ParticleEmitter", "Smoke", "Fire", "Sparkles", "Trail", "Beam",
    "PostEffect", "Sky", "Atmosphere", "SunRaysEffect", "Light", "ColorCorrectionEffect"
}

-- Helper function to check if object should be ignored
local function DescendantOfIgnore(obj)
    local ignoreInstances = {Workspace:FindFirstChild("Map"), Workspace:FindFirstChild("CurrentMap")}
    for _, ignore in pairs(ignoreInstances) do
        if ignore and obj:IsDescendantOf(ignore) then
            return true
        end
    end
    return false
end

-- Remove visual objects (optimized with pcall, silently ignore errors)
local function RemoveVisualObjects()
    pcall(function()
        local count = 0
        for _, obj in pairs(Workspace:GetDescendants()) do
            if not DescendantOfIgnore(obj) then
                -- Skip ALL descendants of BULLET_RAYS and MoneyDrop to avoid warnings
                local parent = obj.Parent
                while parent do
                    if parent.Name == "BULLET_RAYS" or parent.Name == "MoneyDrop" then
                        goto continue
                    end
                    parent = parent.Parent
                end
                
                for _, class in ipairs(visualClasses) do
                    if obj:IsA(class) then
                        -- Silently destroy without printing warnings
                        pcall(function() 
                            if obj and obj.Parent then
                                obj:Destroy() 
                            end
                        end)
                        count = count + 1
                        if count % 50 == 0 then
                            task.wait() -- Yield occasionally to prevent lag spikes
                        end
                    end
                end
                
                ::continue::
            end
        end
        
        if Workspace.Terrain then
            for _, child in pairs(Workspace.Terrain:GetChildren()) do
                for _, class in ipairs(visualClasses) do
                    if child:IsA(class) then
                        pcall(function() 
                            if child and child.Parent then
                                child:Destroy() 
                            end
                        end)
                    end
                end
            end
        end
        
        for _, obj in pairs(Lighting:GetChildren()) do
            pcall(function() 
                if obj and obj.Parent then
                    obj:Destroy() 
                end
            end)
        end
    end)
end

-- Disable shadows
local function DisableShadows()
    pcall(function()
        for _, obj in pairs(Workspace:GetDescendants()) do
            if obj:IsA("BasePart") and not DescendantOfIgnore(obj) then
                obj.CastShadow = false
            end
        end
    end)
end

-- Potatofy parts for performance
local function PotatofyParts()
    pcall(function()
        local partCount = 0
        for _, obj in pairs(Workspace:GetDescendants()) do
            if not DescendantOfIgnore(obj) then
                if obj:IsA("MeshPart") or obj:IsA("Part") then
                    pcall(function() obj.Material = Enum.Material.Plastic end)
                    pcall(function() obj.Reflectance = 0 end)
                    pcall(function() obj.Color = Color3.new(0.5, 0.5, 0.5) end)
                    if obj:IsA("MeshPart") then
                        pcall(function() obj.TextureID = "" end)
                        pcall(function() obj.MeshId = "" end)
                    end
                    partCount = partCount + 1
                    if partCount % 100 == 0 then
                        task.wait()
                    end
                elseif obj:IsA("SpecialMesh") or obj:IsA("BlockMesh") or obj:IsA("FileMesh") then
                    pcall(function() obj:Destroy() end)
                end
            end
        end
        
        for _, v in pairs(MaterialService:GetChildren()) do
            pcall(function() v:Destroy() end)
        end
        pcall(function() MaterialService.Use2022Materials = false end)
    end)
end

-- Optimize rendering settings
local function OptimizeRendering()
    pcall(function()
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 100000
        Lighting.FogStart = 0
        Lighting.Brightness = 0.5
        Lighting.Ambient = Color3.new(0.5, 0.5, 0.5)
        Lighting.OutdoorAmbient = Color3.new(0.5, 0.5, 0.5)
        Lighting.ShadowSoftness = 0
        Lighting.ClockTime = 12
        
        pcall(function()
            sethiddenproperty(Lighting, "Technology", Enum.Technology.Compatibility)
        end)
        
        if settings().Rendering then
            settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
            settings().Rendering.EnableParticles = false
        end
        
        if Workspace.Terrain then
            Workspace.Terrain.WaterWaveSize = 0
            Workspace.Terrain.WaterWaveSpeed = 0
            Workspace.Terrain.WaterReflectance = 0
            Workspace.Terrain.WaterTransparency = 0
            pcall(function()
                sethiddenproperty(Workspace.Terrain, "Decoration", false)
            end)
        end
        
        pcall(function()
            Workspace.StreamingMinRadius = 64
            Workspace.StreamingTargetRadius = 128
        end)
        
        pcall(function()
            Workspace.CurrentCamera.FieldOfView = 120
        end)
        
        pcall(function()
            if setfpscap then
                setfpscap(1e6)
            end
        end)
        
        pcall(function()
            if getnilinstances then
                for _, v in pairs(getnilinstances()) do
                    v:Destroy()
                end
            end
        end)
        
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= Players.LocalPlayer then
                local character = player.Character
                if character then
                    for _, anim in pairs(character:GetDescendants()) do
                        if anim:IsA("Animation") or anim:IsA("AnimationTrack") then
                            anim:Destroy()
                        end
                    end
                end
            end
        end
    end)
end

-- Monitor new objects (optimized)
local function MonitorNewObjects()
    Workspace.DescendantAdded:Connect(function(obj)
        pcall(function()
            if not DescendantOfIgnore(obj) then
                local parent = obj.Parent
                while parent do
                    if parent.Name == "BULLET_RAYS" or parent.Name == "MoneyDrop" then
                        return
                    end
                    parent = parent.Parent
                end
                
                for _, class in ipairs(visualClasses) do
                    if obj:IsA(class) then
                        obj:Destroy()
                        return
                    end
                end
                
                if obj:IsA("BasePart") then
                    obj.CastShadow = false
                    obj.Material = Enum.Material.Plastic
                    obj.Reflectance = 0
                    obj.Color = Color3.new(0.5, 0.5, 0.5)
                elseif obj:IsA("SpecialMesh") or obj:IsA("BlockMesh") or obj:IsA("FileMesh") then
                    obj:Destroy()
                end
            end
        end)
    end)
    
    Lighting.ChildAdded:Connect(function(obj)
        pcall(function()
            obj:Destroy()
        end)
    end)
end

local lastCleanupTime = tick()
local function InitAntiLag()
    RunService.Heartbeat:Connect(function()
        local currentTime = tick()
        if currentTime - lastCleanupTime >= 30 then
            lastCleanupTime = currentTime
            pcall(function()
                RemoveVisualObjects()
                DisableShadows()
                PotatofyParts()
            end)
        end
        
        pcall(function()
            sethiddenproperty(Lighting, "Technology", Enum.Technology.Compatibility)
            if settings().Rendering then
                settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
            end
            Lighting.GlobalShadows = false
            Lighting.FogEnd = 100000
        end)
    end)
end

local success, err = pcall(InitAntiLag)
if not success then
    warn("[Prime DHC Auto Farm] AntiLag initialization failed:", err)
end

task.spawn(function()
    task.wait(2)
    pcall(OptimizeRendering)
    pcall(MonitorNewObjects)
    task.wait(1)
    pcall(RemoveVisualObjects)
    task.wait(1)
    pcall(DisableShadows)
    task.wait(1)
    pcall(PotatofyParts)
end)

-- Variables
local startTime
local startCash

-- Format money helper
local function formatMoney(amount)
    local formatted = tostring(math.floor(amount)):reverse():gsub("(%d%d%d)", "%1,")
    formatted = formatted:reverse():gsub("^,", ""):gsub(",$", "")
    return "$" .. formatted
end

-- Setup GUI
local function setupGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "PrimeFarm"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = Player:WaitForChild("PlayerGui")
    _G.farmGui = screenGui
    
    local blackScreen = Instance.new("Frame")
    blackScreen.Name = "BlackScreen"
    blackScreen.Size = UDim2.new(1, 0, 1, 0)
    blackScreen.BackgroundColor3 = Color3.new(0, 0, 0)
    blackScreen.BorderSizePixel = 0
    blackScreen.ZIndex = 0
    blackScreen.Parent = screenGui
    
    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(0, 320, 0, 280)
    frame.Position = UDim2.new(0.5, -160, 0.5, -140)
    frame.BackgroundColor3 = Color3.fromRGB(15, 23, 42)
    frame.BorderSizePixel = 0
    frame.ZIndex = 10
    frame.Parent = screenGui
    
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(20, 30, 50)),
        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(30, 40, 60)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 30, 50))
    })
    gradient.Rotation = 45
    gradient.Parent = frame
    
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(0, 255, 255)
    stroke.Thickness = 2
    stroke.Parent = frame
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = frame
    
    local header = Instance.new("Frame")
    header.Name = "Header"
    header.Size = UDim2.new(1, 0, 0, 60)
    header.Position = UDim2.new(0, 0, 0, 0)
    header.BackgroundColor3 = Color3.fromRGB(0, 255, 255)
    header.BackgroundTransparency = 0.9
    header.ZIndex = 11
    header.Parent = frame
    
    local headerCorner = Instance.new("UICorner")
    headerCorner.CornerRadius = UDim.new(0, 12)
    headerCorner.Parent = header
    
    local headerPadding = Instance.new("UIPadding")
    headerPadding.PaddingTop = UDim.new(0, 12)
    headerPadding.Parent = header
    
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(1, 0, 0, 22)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundTransparency = 1
    title.Text = "PRIMES DA HOOD AUTO FARM"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18
    title.TextXAlignment = Enum.TextXAlignment.Center
    title.ZIndex = 12
    title.Parent = header
    
    local subtitle = Instance.new("TextLabel")
    subtitle.Name = "Subtitle"
    subtitle.Size = UDim2.new(1, 0, 0, 15)
    subtitle.Position = UDim2.new(0, 0, 0, 25)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "discord.gg/primedhc"
    subtitle.TextColor3 = Color3.fromRGB(200, 255, 255)
    subtitle.Font = Enum.Font.Gotham
    subtitle.TextSize = 12
    subtitle.TextXAlignment = Enum.TextXAlignment.Center
    subtitle.ZIndex = 12
    subtitle.Parent = header
    
    local statsContainer = Instance.new("Frame")
    statsContainer.Name = "StatsContainer"
    statsContainer.Size = UDim2.new(1, -20, 1, -70)
    statsContainer.Position = UDim2.new(0, 10, 0, 65)
    statsContainer.BackgroundTransparency = 1
    statsContainer.ZIndex = 11
    statsContainer.Parent = frame
    
    local function createStatLabel(yPos, name, initialText)
        local label = Instance.new("TextLabel")
        label.Name = name
        label.Size = UDim2.new(1, 0, 0, 30)
        label.Position = UDim2.new(0, 0, 0, yPos)
        label.BackgroundTransparency = 1
        label.Text = initialText or ""
        label.TextColor3 = Color3.fromRGB(220, 220, 220)
        label.Font = Enum.Font.Gotham
        label.TextSize = 15
        label.TextXAlignment = Enum.TextXAlignment.Center
        label.ZIndex = 11
        label.Parent = statsContainer
        return label
    end
    
    createStatLabel(0, "UserLabel", "User: Loading...")
    createStatLabel(35, "FPSLabel", "FPS: Loading...")
    createStatLabel(70, "TimeLabel", "Time Running: Loading...")
    createStatLabel(105, "StartCashLabel", "Start Cash: Loading...")
    createStatLabel(140, "CurrentCashLabel", "Current Cash: Loading...")
    createStatLabel(175, "ProfitLabel", "Total Profit: Loading...")
    
    return screenGui, blackScreen
end

local gui, blackScreen = setupGUI()
local isBlackScreenEnabled = true

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.Comma then
        isBlackScreenEnabled = not isBlackScreenEnabled
        blackScreen.Visible = isBlackScreenEnabled
    end
end)

local function updateGUI()
    pcall(function()
        if not gui or not gui:FindFirstChild("MainFrame") or not gui.MainFrame:FindFirstChild("StatsContainer") then return end
        
        local elapsed = tick() - startTime
        local hours = math.floor(elapsed / 3600)
        local minutes = math.floor((elapsed % 3600) / 60)
        local seconds = math.floor(elapsed % 60)
        local timeString = string.format("%02d:%02d:%02d", hours, minutes, seconds)
        
        local currentCash = Player.DataFolder.Currency.Value
        local profit = currentCash - startCash
        
        gui.MainFrame.StatsContainer.FPSLabel.Text = "FPS: " .. tostring(fpsVar)
        gui.MainFrame.StatsContainer.FPSLabel.TextColor3 = Color3.fromRGB(0, 255, 255)
        gui.MainFrame.StatsContainer.UserLabel.Text = "User: " .. Player.Name
        gui.MainFrame.StatsContainer.UserLabel.TextColor3 = Color3.fromRGB(0, 255, 255)
        gui.MainFrame.StatsContainer.TimeLabel.Text = "Time Running: " .. timeString
        gui.MainFrame.StatsContainer.StartCashLabel.Text = "Start Cash: " .. formatMoney(startCash)
        gui.MainFrame.StatsContainer.CurrentCashLabel.Text = "Current Cash: " .. formatMoney(currentCash)
        
        local profitLabel = gui.MainFrame.StatsContainer.ProfitLabel
        profitLabel.Text = "Total Profit: " .. formatMoney(profit)
        profitLabel.TextColor3 = (profit >= 0) and Color3.fromRGB(0, 255, 255) or Color3.fromRGB(255, 80, 80)
    end)
end

if not Player.Character then
    Player.CharacterAdded:Wait()
end

repeat task.wait() until game:IsLoaded()
repeat task.wait() until Player.Character
repeat task.wait() until Player.Character:FindFirstChild("HumanoidRootPart")
repeat task.wait() until Player:FindFirstChild("DataFolder")
repeat task.wait() until Player.DataFolder:FindFirstChild("Currency")

getgenv().MaxAttackTime = 10
getgenv().CollectRange = 50
getgenv().CollectTime = 5
getgenv().SpawnWait = 1.5
getgenv().ReloadThreshold = 3

startTime = tick()
startCash = Player.DataFolder.Currency.Value

pcall(updateGUI)

task.spawn(function()
    while true do
        pcall(updateGUI)
        task.wait(1)
    end
end)

local function randomDelay(min, max)
    min = min or getgenv().AutofarmSettings.Main.Delay
    max = max or min + 0.2
    task.wait(math.random(min * 100, max * 100) / 100)
end

local function hasAUG()
    local containers = {Player.Backpack}
    local char = Player.Character
    if char then
        table.insert(containers, char)
    end
    
    for _, container in pairs(containers) do
        for _, tool in pairs(container:GetChildren()) do
            if tool:IsA("Tool") and string.lower(tool.Name):find("aug") then
                return true
            end
        end
    end
    return false
end

local function getAUGTool()
    local char = Player.Character
    if not char then return nil end
    
    for _, tool in pairs(char:GetChildren()) do
        if tool:IsA("Tool") and string.lower(tool.Name):find("aug") then
            return tool
        end
    end
    
    for _, tool in pairs(Player.Backpack:GetChildren()) do
        if tool:IsA("Tool") and string.lower(tool.Name):find("aug") then
            return tool
        end
    end
    
    return nil
end

local augBuyPos = Vector3.new(-273.0153041799, 52.2666088321, -216.104867764)
local ammoBuyPos = Vector3.new(-277.8882854219, 52.3626088321, -217.0169677738)

local function findShopItem(pos, isAmmo)
    local shop = workspace:WaitForChild("Ignored"):WaitForChild("Shop")
    local minDist = math.huge
    local bestCD, bestHead, bestName = nil, nil, ""
    
    for _, item in pairs(shop:GetChildren()) do
        local nameLower = string.lower(item.Name)
        if nameLower:find("aug") and (isAmmo == (nameLower:find("ammo") ~= nil)) then
            local head = item:FindFirstChild("Head")
            local cd = item:FindFirstChild("ClickDetector") or (head and head:FindFirstChild("ClickDetector"))
            if cd and head then
                local dist = (head.Position - pos).Magnitude
                if dist < minDist then
                    minDist = dist
                    bestCD = cd
                    bestHead = head
                    bestName = item.Name
                end
            end
        end
    end
    
    return bestCD, bestHead, minDist, bestName
end

local function buyItem(pos, isAmmo)
    local char = Player.Character
    if not char then return false end
    
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.CFrame = CFrame.new(pos)
    hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
    hrp.AssemblyAngularVelocity = Vector3.new(0, 0, 0)
    task.wait(0.5)
    
    local cd, head, dist, name = findShopItem(pos, isAmmo)
    if cd and head then
        if isAmmo then
            for i = 1, 100 do
                fireclickdetector(cd)
                task.wait(0.035)
            end
        else
            fireclickdetector(cd)
        end
        return true
    else
        return false
    end
end

local function autoBuy()
    if not hasAUG() then
        buyItem(augBuyPos, false)
        task.wait(3)
    end
    buyItem(ammoBuyPos, true)
end

autoBuy()

local function collectMoney(moneyPart)
    if moneyPart and moneyPart.Parent then
        local cd = moneyPart:FindFirstChild("ClickDetector")
        if cd then
            pcall(fireclickdetector, cd)
        end
    end
end

-- IMPROVED robTarget function with better Mouse simulation
local function robTarget(targetModel, openPart)
    local char = Player.Character
    if not char or not char.Parent then return end
    
    local hrp = char.HumanoidRootPart
    local hum = char.Humanoid
    local targetHead = targetModel:FindFirstChild("Head")
    if not targetHead then return end
    
    local aimPosition = targetHead.Position - Vector3.new(0, 3, 0)
    local tpPos = openPart.Position - openPart.CFrame.LookVector * 4
    
    hrp.CFrame = CFrame.lookAt(tpPos, aimPosition)
    hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
    randomDelay(0.3, 0.5)
    
    local tool = getAUGTool()
    if not tool then
        return
    end
    
    if tool.Parent ~= char then
        hum:EquipTool(tool)
        task.wait(0.6)
    end
    
    -- Use getconnections for Mouse hooks if available
    local useConnections = getconnections ~= nil
    local originalHook
    
    if not useConnections then
        -- Fallback to hookmetamethod
        local __index
        __index = hookmetamethod(game, "__index", function(t, k)
            if t:IsA("Mouse") and (k == "Hit" or k == "Target") then
                if k == "Hit" then
                    return CFrame.new(aimPosition)
                elseif k == "Target" then
                    return targetHead
                end
            end
            return __index(t, k)
        end)
        originalHook = __index
    end
    
    local shootStart = tick()
    local shootConn
    shootConn = RunService.RenderStepped:Connect(function()
        if (tick() - shootStart) > getgenv().MaxAttackTime or targetModel.Humanoid.Health <= 0 then
            if shootConn then
                shootConn:Disconnect()
            end
            return
        end
        if UserInputService.MouseBehavior == Enum.MouseBehavior.LockCenter then
            hrp.CFrame = CFrame.lookAt(hrp.Position, aimPosition)
        end
        local equipped = char:FindFirstChildOfClass("Tool")
        if equipped and string.lower(equipped.Name):find("aug") then
            equipped:Activate()
            task.wait(0.05)
            equipped:Activate()
        else
            tool = getAUGTool()
            if tool then
                hum:EquipTool(tool)
                task.wait(0.4)
            end
        end
    end)
    
    while targetModel.Humanoid.Health > 0 and (tick() - shootStart) < getgenv().MaxAttackTime do
        task.wait(0.1)
    end
    
    if shootConn then
        shootConn:Disconnect()
    end
    
    if not useConnections and originalHook then
        hookmetamethod(game, "__index", originalHook)
    end
    
    randomDelay(getgenv().SpawnWait, getgenv().SpawnWait + 0.3)
    
    local targetPos = targetModel.PrimaryPart and targetModel.PrimaryPart.Position or (targetModel:FindFirstChild("HumanoidRootPart") and targetModel.HumanoidRootPart.Position) or openPart.Position
    hrp.CFrame = CFrame.new(targetPos + Vector3.new(0, 3, 0))
    hrp.AssemblyLinearVelocity = Vector3.new(0, 0, 0)
    
    local vacuumStart = tick()
    while (tick() - vacuumStart) < getgenv().CollectTime do
        local dropsFolder = Workspace:FindFirstChild("Ignored")
        local foundCash = false
        if dropsFolder then
            local dropFolder = dropsFolder:FindFirstChild("Drop")
            if dropFolder then
                for _, cashPart in pairs(dropFolder:GetChildren()) do
                    if cashPart:IsA("Part") and cashPart.Name == "MoneyDrop" then
                        local dist = (cashPart.Position - targetPos).Magnitude
                        if dist <= getgenv().CollectRange then
                            foundCash = true
                            collectMoney(cashPart)
                            randomDelay(0.1, 0.2)
                        end
                    end
                end
            end
        end
        if not foundCash then
            randomDelay(0.2, 0.4)
        end
    end
    
    hrp.CFrame = CFrame.new(9999, 50, 9999)
end

local function performHop()
    if _G.farmGui then _G.farmGui:Destroy() end
    
    local placeId = game.PlaceId
    local jobId = game.JobId
    local url = "https://games.roblox.com/v1/games/" .. placeId .. "/servers/Public?sortOrder=Asc&sortBy=Active&limit=100"
    
    local success, result = pcall(HttpService.RequestAsync, HttpService, {Url = url, Method = "GET"})
    if success and result.Body then
        local data = HttpService:JSONDecode(result.Body)
        if data and data.data and #data.data > 0 then
            for _, server in pairs(data.data) do
                if server.id ~= jobId and server.playing < server.
